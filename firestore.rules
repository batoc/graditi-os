rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Herramientas/Inventario
    match /herramientas/{toolId} {
      allow read: if true; // Cualquiera puede ver el inventario
      allow create, update, delete: if request.auth != null; // Solo usuarios autenticados pueden modificar
    }
    
    // Movimientos
    match /movimientos/{movementId} {
      allow read: if true; // Cualquiera puede ver movimientos
      allow create: if request.auth != null; // Solo usuarios autenticados pueden crear
      allow update, delete: if false; // No se pueden modificar movimientos (registro inmutable)
    }
    
    // Mantenimiento
    match /mantenimientos/{maintenanceId} {
      allow read: if true;
      allow create, update: if request.auth != null;
      allow delete: if false; // No borrar historial de mantenimiento
    }
    
    // Colaboradores
    match /colaboradores/{colaboradorId} {
      allow read: if true;
      allow create, update, delete: if request.auth != null;
    }
    
    // Obras
    match /obras/{obraId} {
      allow read: if true;
      allow create, update, delete: if request.auth != null;
    }
    
    // Préstamos
    match /prestamos/{prestamoId} {
      allow read: if true;
      allow create, update: if request.auth != null;
      allow delete: if false; // No borrar historial de préstamos
    }

    // Materiales
    match /materiales/{materialId} {
      allow read: if true;
      allow create, update: if request.auth != null;
      allow delete: if false; // Preferir desactivar a borrar para mantener historia
    }

    // Movimientos de Materiales
    match /movimientos_materiales/{movimientoId} {
      allow read: if true;
      allow create: if request.auth != null;
      allow update, delete: if false; // Inmutable, como una transacción contable
    }
  }
}
